{% extends 'base.html' %}
{% load static %}
{% block title %}{{ deal.title }}{% endblock %}


{% block content %}

  <h1>{{ deal.title }}</h1>
  {% if user.is_authenticated %}
    {% if user.id == deal.author.id %}
      <small>
      <a href="{% url 'update_deal' deal.pk %}">Edit</a>
      <a href="{% url 'delete_deal' deal.pk %}">Delete</a> <br/>
      </small>
    {% endif %}
  {% endif %}
   Price: ${{deal.price}} <br/>
   Date Posted : {{ deal.date_posted }}<br/>
   {{ deal.store }}

  <hr>
  <br/>

  <div class="clearfix">
    {% if deal.header_image %}
      <img src="{{ deal.header_image.url }}" class="col-md-5 float-md-end mb-3 ms-md-3" width="280" height="280" maxclass="img-fluid rounded-start">
    {% endif %}

    <br/><br/>
    {{ deal.summary|safe}}
  </div>
<br/><br/>


  <form action = "{% url 'like_deal' deal.pk %}"
  method="POST">
    {% csrf_token %}
    {% if user.is_authenticated %}

      {% if liked %}
        <button type="submit", name="deal_id", value
        ="{{ deal.id }}", class="btn btn-primary">Unlike</button>
      {% else %}
        <button type="submit", name="deal_id", value
        ="{{ deal.id }}", class="btn btn-primary">Like</button>
      {% endif %}
      - {{ total_likes }} Likes
    {% else %}
      <a class="btn btn-primary" href="{% url 'login' %}" role="button">Like</a>
    {% endif %}
  </form>



  <br/><br/>

  <div class="card mb-3">
    <div class="row g-0">
      <div class="col-md-2">
        {% if deal.author.profile.profile_pic %}
              <img src="{{ deal.author.profile.profile_pic.url }}" width="128" height="128" maxclass="img-fluid rounded-start">
        {% else %}
              <img src="{% static 'catalog/images/default_profile.png' %}" width="128" height="128" maxclass="img-fluid rounded-start">
        {% endif %}
      </div>
      <div class="col-md-10">
        <div class="card-body">

          <h5 class="card-title"><a href="{% url 'show_profile_page' deal.author.profile.id %}">{{ deal.author.username }}</a></h5>
          <p class="card-text">{{ deal.author.profile.bio }}</p>
        </div>
      </div>
    </div>
  </div>
<br/><br/>


<form action="{% url 'add_comment' deal.pk %}" enctype = "multiparty/form-data" method = "POST">
  {% csrf_token %}
  <h3>Write a New Comment</h3>
        {{ form.content }}
  <br/>
  <button class="btn btn-primary", value="{{ deal.id }}", type="submit">Post</button>
</form>
<br/><br/>
{% if not deal.comments.all %}
  No comments yet...
{% else %}
  <br/><br/>
    {% for comment in deal.comments.all %}
      <strong>
        {{ comment.name }} -
        {{ comment.date_added }}
      </strong>
      <br/>
      {{ comment.content }}
      <hr>
    {% endfor %}
{% endif %}
<br/><br/>



{% endblock %}
